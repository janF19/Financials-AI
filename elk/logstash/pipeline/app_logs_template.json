{
  "index_patterns": ["app-*-logs-*"],
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 0
  },
  "mappings": {
    "properties": {
      "@timestamp": { "type": "date" },
      "service": {
        "properties": {
          "name": { "type": "keyword" }
        }
      },
      "log": {
        "properties": {
          "level": { "type": "keyword" }
        }
      },
      "message": { "type": "text", "fields": { "keyword": { "type": "keyword", "ignore_above": 256 }}},
      "log_payload": { "type": "object", "enabled": false },
      "container": {
        "properties": {
          "id": { "type": "keyword" },
          "name": { "type": "keyword" },
          "image": { "properties": { "name": { "type": "keyword" } } },
          "labels": { "type": "object", "dynamic": true }
        }
      },
      "host": { "properties": { "name": { "type": "keyword" }}},
      "source": {
        "properties": {
          "ip": { "type": "ip" },
          "port": { "type": "long" },
          "geo": {
            "properties": {
              "location": { "type": "geo_point" },
              "country_name": { "type": "keyword" },
              "city_name": { "type": "keyword" }
            }
          }
        }
      },
      "http": {
        "properties": {
          "request": { "properties": { "method": { "type": "keyword" }}},
          "response": { "properties": { "status_code": { "type": "long" }}},
          "version": { "type": "keyword" }
        }
      },
      "url": {
        "properties": {
          "original": { "type": "keyword" },
          "path": { "type": "keyword" },
          "domain": { "type": "keyword" }
        }
      },
      "user_agent": {
        "properties": {
          "original": {"type": "text", "fields": {"keyword": {"type": "keyword", "ignore_above": 256}}},
          "name": {"type": "keyword"},
          "os": {"properties": {"name": {"type": "keyword"}, "full": {"type": "keyword"}}},
          "device": {"properties": {"name": {"type": "keyword"}}}
        }
      },
      "celery": {
        "properties": {
            "task_name": { "type": "keyword" },
            "task_id": { "type": "keyword" },
            "task_status": { "type": "keyword" },
            "task_duration": { "type": "float" }
        }
      },
      "tags": { "type": "keyword" }
    }
  }
} 